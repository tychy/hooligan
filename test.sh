#!/bin/bash

assert() {
  expected="$1"
  input="$2"

  ./bin/exe.out "$input" > tmp.s
  cc -o tmp tmp.s helper/helper.c
  ./tmp
  actual="$?"

  if [ "$actual" = "$expected" ]; then
    echo "$input => $actual"
  else
    echo "$input => $expected expected, but got $actual"
    exit 1
  fi
}

assert 22 "main(){ 5+21-4; }"
assert 131 "main(){ 50+121-40; }"
assert 131 "main(){ 50    +   121-40; }"
assert 41 "main(){  12 + 34 - 5 ; }"
assert 10 "main(){ 2 * 5; }"
assert 42 "main(){ 7 * 2 * 3; }"
assert 13 "main(){ 1 + 3 * 4; }"
assert 6 "main(){ 5 - 2 * 3 + 7; }"
assert 37 "main(){ 4 * 5 * 2 + 6 * 7 - 5 * 9; }"
assert 5 "main(){ 5*1*1*1*1*1*1*1*1*1; }"
assert 2 "main(){ 8 / 4; }"
assert 5 "main(){ 60 / 11; }"
assert 6 "main(){ 18 / 6 + 1 * 3; }"
assert 47 "main(){ 5+6*7; }"
assert 15 "main(){ 5*(9-6); }"
assert 4 "main(){ (3+5)/2; }"
assert 32 "main(){ ( 4 * 9) - (6 * 5) / 7; }"
assert 0 "main(){ 1 + -3 + 2; }"
assert 1 "main(){ -(-1); }"
assert 0 "main(){ 3 + -3; }"
assert 20 "main(){ -5 * -4; }"
assert 5 "main(){ -10 / -2; }"
assert 1 "main(){ 1==1; }"
assert 0 "main(){ 1==2; }"
assert 1 "main(){ 4*6 == 3*8; }"
assert 1 "main(){ 500 * 100 == 250 * 200; }"
assert 7 "main(){ (1 == 1) + 6; }"
assert 1 "main(){ 0!=1; }"
assert 0 "main(){ 5!=2+3; }"
assert 1 "main(){ 5>=2+3; }"
assert 0 "main(){ 5>2+3; }"
assert 1 "main(){ 5<=2+3; }"
assert 0 "main(){ 5<2+3; }"
assert 1 "main(){ 2>1; }"
assert 0 "main(){ 2<1; }"
assert 1 "main(){ 2>=1; }"
assert 0 "main(){ 2<=1; }"
assert 1 "main(){ (4 > 1) >= (1 < 0); }"
assert 1 "main(){ (4 > 1) > (1 < 0); }"
assert 0 "main(){ (4 > 1) <= (1 < 0); }"
assert 0 "main(){ (4 > 1) < (1 < 0); }"
assert 0 "main(){ a = 0; }"
assert 3 "main(){ a = 3; }"
assert 3 "main(){ a = b = 3; }"
assert 5 "main(){ 1+2;2+3; }"
assert 6 "main(){ 1;1;1;1;1;1;1;1;1;3+3; }"
assert 2 "main(){ a=2;a; }"
assert 5 "main(){ b=2;c=3;b+c; }"
assert 5 "main(){ foo=2;bar=3;foo+bar; }"
assert 27 "main(){ foo=2;bar=3;hogefuga=9;hogefuga*bar; }"
assert 1 "main(){ return 1; }"
assert 2 "main(){ return 2; return 3; return 4; }"
assert 5 "main(){ returnx = 15; a = 5; a; }"
assert 90 "main(){ a = 10; b = 20; return (a+b)*3; }"
assert 2 "main(){ if(1)2; }"
assert 3 "main(){ if(0)2; else 3; }"
assert 2 "main(){ a=3;if(a==3)2; else 3; }"
assert 12 "main(){ a=2; for(i=0; i<10; i=i+1) a=a+1; return a; }"
assert 20 "main(){ for(counter=0;counter<100;counter=counter+1) if(counter*counter==400) return counter; return 1; }"
assert 1 "main(){ for(d=0;d<100;d=d+1) if(d*d==401) return d; return 1; }"
assert 100 "main(){ a=0;for(i=0;i<10;i=i+1) for(j=0;j<10;j=j+1) a = a+1; return a; }"
assert 3 "main(){ a=1; if(a==0)if(a!=0)return 0; else return 4; else return 3; }"
assert 10 "main(){ for(i=0;i<10;) i=i+1;i; }"
assert 10 "main(){ i=0;for(;i<10;) i=i+1;i; }"
assert 10 "main(){ i=0;for(;;) if(i==10)return i;else i=i+1;i; }"
assert 10 "main(){ i=0;while(i<10) i = i+1;i; }"
assert 5 "main(){ i=0;while(i<10) if(i==5) return i;else i = i+1;i; }"
assert 10 "main(){ i=0;while(i<10) while(i<10)i=i+1;i; }"
assert 1 "main(){ {1;} }"
assert 12 "main(){ i=0;{i=i+2;i=i*6;} }"
assert 1 "main(){ hello_world(); }"
assert 10 "main(){ foo(); } foo(){return 10;}"
assert 6 "main(){ two(3); } two(x) return 2 * x;"
assert 48 "main(){ two(24); } two(hogehoge) { hogehoge * 2; }"
assert 148 "main(){ two(5 * 20 - 2 * (6+7)); } two(y){return 2*y;}"
assert 43 "main(){ BIG(33); } BIG(x)x+10;"
assert 25 "main(){ add(12,13); } add(x,y){ return x+y; }"
assert 68 "main(){ add_tri(4, 50, 14); } add_tri(a,b,c) a+b+c;"
assert 10 "main(){ add_qua(1,3,2,4); } add_qua(a,b,c,d) a+b+c+d;"
assert 17 "main(){ add_pen(-100,200,57,-117,-23); }add_pen(i,j,k,l,m) i+j+k+l+m;"
assert 23 "main(){ add_hex(23,19,-9,-15,5,0); } add_hex(one,two,three,four,five,six) one+two+three+four+five+six;"
assert 30 "main(){ hoge(); } hoge(){ return 30; }"
rm tmp
rm tmp.s

echo OK
